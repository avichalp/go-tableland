# goreleaser.yml

before:
  hooks:
  - go mod tidy

project_name: api

builds:
- binary: api
  id: api
  main: ./cmd/api
  goos:
    - linux
    - darwin    
  goarch:
    - amd64
    - arm64
  ignore:
    - goos: linux
      goarch: arm64
  env:
    - CGO_ENABLED=1
  ldflags: -s -w
  overrides:
    - goos: linux
      goarch: amd64
      goamd64: v1
      env:
        - CGO_ENABLED=1
        - CC=x86_64-linux-gnu-gcc
        - CXX=x86_64-linux-gnu-g++
      ldflags:
        - -s -w
        - -extldflags "-static"
    - goos: linux
      goarch: arm64
      env:
        - CGO_ENABLED=1
        - CC=aarch64-linux-gnu-gcc
        - CXX=aarch64-linux-gnu-g++
      ldflags:
        - -s -w
        - -extldflags "-static"
    - goos: darwin
      goarch: amd64
      goamd64: v1
      env:
        - CGO_ENABLED=1
        - CC=o64-clang
        - CXX=o64-clang++
    - goos: darwin
      goarch: arm64
      env:
        - CGO_ENABLED=1
        - CC=oa64-clang
        - CXX=oa64-clang++
# - binary: api-win
#   id: api-win
#  main: ./cmd/api
#  goos:    
#    - windows
#  goarch:
#    - amd64    
#  env:
#    - CGO_ENABLED=1
#  ldflags: -s -w
  
archives:
  - id: api-archive
    format: tar.gz
    builds:
      - api
    name_template: "{{ .ProjectName }}-{{ .Os }}-{{ .Arch }}-{{ .ShortCommit }}"
  #- id: api-archive-win
  #  format: zip
  #  builds:
  #    - api-win
  #  name_template: "{{ .ProjectName }}-{{ .Os }}-{{ .Arch }}"  

checksum:
  disable: true